metadata:
  name: getnettcpconnection-with-powershell-script-block
  version: 8.0.0
  description: The following analytic detects the execution of the `Get-NetTcpconnection`
    PowerShell cmdlet using PowerShell Script Block Logging (EventCode=4104). This
    cmdlet lists network connections on a system, which adversaries may use for situational
    awareness and Active Directory discovery. Monitoring this activity is crucial
    as it can indicate reconnaissance efforts by an attacker. If confirmed malicious,
    this behavior could allow an attacker to map the network, identify critical systems,
    and plan furt
  author: Mauricio Velazco, Splunk
  tags:
  - hunting
  - splunk-security-content
  - active-directory-discovery
  mitre_attack:
    techniques:
    - id: T1049
      name: Technique T1049
    tactics: []
files:
  bundled: []
  references:
  - uri: https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1059.001/powershell_script_block_logging/nettcpconnection.log
    description: XmlWinEventLog:Microsoft-Windows-PowerShell/Operational - XmlWinEventLog
    format: auto
    schema: raw
    sourcetype: XmlWinEventLog
defaults:
  replay:
    delta_factor: 1.0
    base_time: earliest
    target_time: now-1h
  schema: raw
