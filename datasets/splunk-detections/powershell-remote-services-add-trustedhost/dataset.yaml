metadata:
  name: powershell-remote-services-add-trustedhost
  version: 8.0.0
  description: 'The following analytic detects the execution of a PowerShell script
    that modifies the ''TrustedHosts'' configuration via EventCode 4104. It leverages
    PowerShell Script Block Logging to identify commands targeting WSMan settings,
    specifically those altering or concatenating trusted hosts. This activity is significant
    as it can indicate attempts to manipulate remote connection settings, potentially
    allowing unauthorized remote access. If confirmed malicious, this could enable
    attackers to establish '
  author: Teoderick Contreras, Splunk
  tags:
  - ttp
  - splunk-security-content
  - darkgate-malware
  mitre_attack:
    techniques:
    - id: T1021.006
      name: Technique T1021.006
    tactics: []
files:
  bundled: []
  references:
  - uri: https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1021.006/wsman_trustedhost/wsman_pwh.log
    description: XmlWinEventLog:Microsoft-Windows-PowerShell/Operational - XmlWinEventLog
    format: auto
    schema: raw
    sourcetype: XmlWinEventLog
defaults:
  replay:
    delta_factor: 1.0
    base_time: earliest
    target_time: now-1h
  schema: raw
