metadata:
  name: serviceprincipalnames-discovery-with-setspn
  version: 9.0.0
  description: The following analytic detects the use of `setspn.exe` to query the
    domain for Service Principal Names (SPNs). This detection leverages Endpoint Detection
    and Response (EDR) data, focusing on specific command-line arguments associated
    with `setspn.exe`. Monitoring this activity is crucial as it often precedes Kerberoasting
    or Silver Ticket attacks, which can lead to credential theft. If confirmed malicious,
    an attacker could use the gathered SPNs to escalate privileges or persist within
    the envi
  author: Michael Haag, Splunk
  tags:
  - ttp
  - splunk-security-content
  - active-directory-discovery
  - active-directory-privilege-escalation
  - compromised-windows-host
  mitre_attack:
    techniques:
    - id: T1558.003
      name: Technique T1558.003
    tactics: []
files:
  bundled: []
  references:
  - uri: https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1558.003/atomic_red_team/windows-sysmon_setspn.log
    description: XmlWinEventLog:Microsoft-Windows-Sysmon/Operational - XmlWinEventLog
    format: auto
    schema: raw
    sourcetype: XmlWinEventLog
defaults:
  replay:
    delta_factor: 1.0
    base_time: earliest
    target_time: now-1h
  schema: raw
