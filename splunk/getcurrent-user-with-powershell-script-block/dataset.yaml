metadata:
  name: getcurrent-user-with-powershell-script-block
  version: 8.0.0
  description: The following analytic detects the execution of the `GetCurrent` method
    from the WindowsIdentity .NET class using PowerShell Script Block Logging (EventCode=4104).
    This method identifies the current Windows user. The detection leverages PowerShell
    script block logs to identify when this method is called. This activity is significant
    because adversaries and Red Teams may use it to gain situational awareness and
    perform Active Directory discovery on compromised endpoints. If confirmed malicious,
    t
  author: Mauricio Velazco, Splunk
  tags:
  - hunting
  - splunk-security-content
  - active-directory-discovery
  mitre_attack:
    techniques:
    - id: T1033
      name: Technique T1033
    tactics: []
files:
  bundled: []
  references:
  - uri: https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1033/AD_discovery/windows-powershell-xml.log
    description: XmlWinEventLog:Microsoft-Windows-PowerShell/Operational - XmlWinEventLog
    format: text
    schema: raw
    sourcetype: XmlWinEventLog
defaults:
  replay:
    delta_factor: 1.0
    base_time: earliest
    target_time: now-1h
  schema: raw
