metadata:
  name: windows-ssh-proxy-command
  version: 3.0.0
  description: 'This detection identifies potential abuse of SSH "ProxyCommand" or
    "LocalCommand" by monitoring for suspicious process execution patterns.

    Specifically, it looks for instances where ssh.exe (as a parent process) containing
    "ProxyCommand" or "LocalCommand" in its arguments spawns potentially malicious
    child processes like mshta, powershell, wscript, or cscript, or processes containing
    "http" in their command line.

    This technique can be used by attackers to execute arbitrary commands through
    SSH p'
  author: Michael Haag, AJ King, Nasreddine Bencherchali, Splunk, Jesse Hunter, Splunk
    Community Contributor
  tags:
  - anomaly
  - splunk-security-content
  - zdi-can-25373-windows-shortcut-exploit-abused-as-zero-day
  - living-off-the-land
  - hellcat-ransomware
  mitre_attack:
    techniques:
    - id: T1572
      name: Technique T1572
    - id: T1059.001
      name: Technique T1059.001
    - id: T1105
      name: Technique T1105
    tactics: []
files:
  bundled: []
  references:
  - uri: https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1572/ssh_proxy_command/sshproxycommand_windows-sysmon.log
    description: XmlWinEventLog:Microsoft-Windows-Sysmon/Operational - XmlWinEventLog
    format: text
    schema: raw
    sourcetype: XmlWinEventLog
defaults:
  replay:
    delta_factor: 1.0
    base_time: earliest
    target_time: now-1h
  schema: raw
