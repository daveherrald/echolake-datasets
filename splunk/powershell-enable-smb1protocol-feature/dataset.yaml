metadata:
  name: powershell-enable-smb1protocol-feature
  version: 8.0.0
  description: The following analytic detects the enabling of the SMB1 protocol via
    `powershell.exe`. It leverages PowerShell script block logging (EventCode 4104)
    to identify the execution of the `Enable-WindowsOptionalFeature` cmdlet with the
    `SMB1Protocol` parameter. This activity is significant because enabling SMB1 can
    facilitate lateral movement and file encryption by ransomware, such as RedDot.
    If confirmed malicious, this action could allow an attacker to propagate through
    the network, encrypt files, a
  author: Teoderick Contreras, Splunk
  tags:
  - ttp
  - splunk-security-content
  - ransomware
  - malicious-powershell
  - hermetic-wiper
  mitre_attack:
    techniques:
    - id: T1027.005
      name: Technique T1027.005
    tactics: []
files:
  bundled: []
  references:
  - uri: https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1059.001/powershell_script_block_logging/sbl_xml.log
    description: XmlWinEventLog:Microsoft-Windows-PowerShell/Operational - XmlWinEventLog
    format: text
    schema: raw
    sourcetype: XmlWinEventLog
defaults:
  replay:
    delta_factor: 1.0
    base_time: earliest
    target_time: now-1h
  schema: raw
