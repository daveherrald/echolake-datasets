metadata:
  name: wmi-recon-running-process-or-services
  version: 9.0.0
  description: The following analytic identifies suspicious PowerShell script execution
    via EventCode 4104, where WMI performs an event query to list running processes
    or services. This detection leverages PowerShell Script Block Logging to capture
    and analyze script block text for specific WMI queries. This activity is significant
    as it is commonly used by malware and APT actors to map security applications
    or services on a compromised machine. If confirmed malicious, this could allow
    attackers to identify an
  author: Teoderick Contreras, Splunk
  tags:
  - anomaly
  - splunk-security-content
  - malicious-powershell
  - hermetic-wiper
  - data-destruction
  mitre_attack:
    techniques:
    - id: T1592
      name: Technique T1592
    tactics: []
files:
  bundled: []
  references:
  - uri: https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1059.001/powershell_script_block_logging/win32process.log
    description: XmlWinEventLog:Microsoft-Windows-PowerShell/Operational - XmlWinEventLog
    format: text
    schema: raw
    sourcetype: XmlWinEventLog
defaults:
  replay:
    delta_factor: 1.0
    base_time: earliest
    target_time: now-1h
  schema: raw
