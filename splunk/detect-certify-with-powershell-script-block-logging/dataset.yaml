metadata:
  name: detect-certify-with-powershell-script-block-logging
  version: 9.0.0
  description: 'The following analytic detects the use of the Certify tool via an
    in-memory PowerShell function to enumerate Active Directory Certificate Services
    (AD CS) environments. It leverages PowerShell Script Block Logging (EventCode
    4104) to identify specific command patterns associated with Certify''s enumeration
    and exploitation functions. This activity is significant as it indicates potential
    reconnaissance or exploitation attempts against AD CS, which could lead to unauthorized
    certificate issuance. '
  author: Steven Dick
  tags:
  - ttp
  - splunk-security-content
  - windows-certificate-services
  - malicious-powershell
  mitre_attack:
    techniques:
    - id: T1059.001
      name: Technique T1059.001
    - id: T1649
      name: Technique T1649
    tactics: []
files:
  bundled: []
  references:
  - uri: https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1649/certify_abuse/certify_esc1_abuse_powershell.log
    description: XmlWinEventLog:Microsoft-Windows-PowerShell/Operational - XmlWinEventLog
    format: text
    schema: raw
    sourcetype: XmlWinEventLog
defaults:
  replay:
    delta_factor: 1.0
    base_time: earliest
    target_time: now-1h
  schema: raw
